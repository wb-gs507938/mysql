# TOP SQL {#concept_t52_5sk_xfb .concept}

SQL Server CloudDBA提供实时TOP SQL和历史TOP SQL查询功能，挖掘出SQL语句级别的详细性能开销。

**说明：** 目前仅SQL Server实例支持此功能。

## 操作步骤 {#section_zj3_yxk_xfb .section}

1.  登录[RDS管理控制台](https://rds.console.aliyun.com/)。
2.  在页面左上角，选择实例所在地域。

    ![地域截图](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/7882/154745996537169_zh-CN.png)

3.  找到目标实例，单击实例ID。
4.  在左侧导航栏中，选择**CloudDBA** \> **性能优化**。
5.  选择TOP SQL页签，执行如下操作：
    -   查询实时TOP SQL:

        在页面右侧选择**自动刷新间隔**、、**排序方式**、**显示条数**并打开**自动刷新**右侧的开关即可。

        **说明：** 可以在**实时TOP SQL-列表**框中单击Statement和SQL文本列中的参数进行**复制**。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/64927/154745996532907_zh-CN.png)

    -   查询历史TOP SQL：
        1.  在**历史TOP SQL**框中选择开始时间和时长，单击**获取审计日志**，等待查询审计日志任务完成并单击**刷新**。
        2.  单击**查看**，即可查询到该时间段内详细的SQL分析。

            ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/64927/154745996632912_zh-CN.png)


## 页面介绍 {#section_srt_1ml_xfb .section}

-   TOP SQL总览：查看整个页面数据的最后更新时间和对整个页面进行控制。详细参数说明如下。

    |参数|说明|
    |--|--|
    |自动刷新的时间间隔|如果打开自动刷新，页面自动刷新的时间间隔有四个值可选，分别是5、10、30和60秒。|
    |用户TOP SQL语句性能消耗排序方式|实例的实时TOP SQL排序，可以根据平均CPU开销、平均执行耗时、总CPU开销、总逻辑读、总物理读等方式进行排序。|
    |显示条数|用户需要查看的TOP多少条SQL语句，有三个值供选择，分别是5、10和15条。|
    |自动刷新|设置自动刷新页面实时TOP SQL信息。|
    |数据更新时间|RDS实例统计信息页面数据的产生时间。|
    |保存PDF|如果您需要将页面保存到本地，请单击**保存PDF**，耐心等待PDF文件生成。|

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/64927/154745996532907_zh-CN.png)

-   实时TOP SQL-平均开销：从平均CPU开销、平均执行耗时、平均返回行、平均逻辑读、平均物理读和平均逻辑写六个方面查看实例中的TOP SQL。详细参数说明如下。

    |参数|说明|
    |--|--|
    |平均CPU开销|SQL语句平均每次执行CPU开销的时间排名，单位为毫秒。|
    |平均执行耗时|SQL语句平均每次执行耗时的排名，单位为毫秒。|
    |平均返回行|SQL语句平均每次执行返回的行数的排名。|
    |平均逻辑读|SQL语句平均每次执行的逻辑读消耗的排名。|
    |平均物理读|SQL语句平均每次执行的物理读消耗的排名。|
    |平均逻辑写|SQL语句平均每次执行的逻辑写消耗的排名。|

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/64927/154745996632908_zh-CN.png)

-   实时TOP SQL-总开销：从总CPU开销、总执行耗时、总返回行、总逻辑读、总物理读和总执行次数六个方面查看实例中的TOP SQL。详细参数说明如下。

    |参数|说明|
    |--|--|
    |总CPU开销|SQL语句总共执行CPU消耗的时间排名，单位为毫秒。|
    |总执行耗时|SQL语句总执行耗时的排名，单位为毫秒。|
    |总返回行|SQL语句总共执行返回的行数的排名。|
    |总逻辑读|SQL语句总共执行的逻辑读消耗的排名。|
    |总物理读|SQL语句总共执行的物理读消耗的排名。|
    |总执行次数|SQL语句总共执行的次数的排名。|

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/64927/154745996632909_zh-CN.png)

-   实时TOP SQL-列表：展示实例中的实时TOP SQL列表信息。详细参数说明如下。

    |参数|说明|
    |--|--|
    |数据库|执行该语句所在的数据库名称。|
    |Statement|当前执行的SQL语句，点击可以查看详细语句。|
    |SQL文本|当前SQL语句块文本，点击可以查看详细文本。|
    |执行次数|总共执行次数。|
    |总CPU耗时|总的CPU开销。|
    |平均CPU耗时|平均每次执行的CPU开销。|
    |执行耗时|总的执行耗时。|
    |平均执行耗时|平均每次执行耗时。|
    |总返回行|总的返回行数。|
    |平均返回行|平均每次执行返回行数。|
    |总逻辑读|总的逻辑读开销。|
    |平均逻辑读|平均每次执行的逻辑读开销。|
    |总物理读|总的物理读开销。|
    |平均物理读|平均每次执行的物理读开销。|
    |总逻辑写|总的逻辑写入开销。|
    |平均逻辑写|平均每次执行的逻辑写入开销。|
    |最后执行时间|该语句最后的执行时间。|

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/64927/154745996632910_zh-CN.png)

-   历史TOP SQL：通过分析用户一段时间内的审计日志功能，来获取用户历史的TOP SQL信息。详细参数说明如下。

    |参数|说明|
    |--|--|
    |开始时间|获取历史TOP SQL的起始时间。|
    |时长|审计日志的时间跨度。|
    |获取审计日志|下发查询审计日志任务。|
    |刷新|更新获取审计日志的进度百分比，更新完成显示SQL记录数。|
    |查看|点击可以查看该时间段详细的SQL分析。|
    |删除|点击可以删除该时间段的审计日志。|

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/64927/154745996632911_zh-CN.png)

    单击**查看**按钮后，可以查看该时间段详细的历史SQL分析。详细参数说明如下。

    |参数|说明|
    |--|--|
    |实例名称|S实例ID。|
    |数据库名称|执行语句所在的数据库名称。|
    |SQL文本|SQL语句文本，点击可以查看全部的SQL语句信息。|
    |用户名称|执行语句的用户名称。|
    |执行次数|对应SQL语句执行的次数。|
    |总CPU开销|对应SQL语句执行的总CPU开销。|
    |平均CPU开销|对应SQL语句执行的平均CPU开销。|
    |CPU最大开销|对应SQL语句执行最大CPU开销。|
    |CPU最小开销|对应SQL语句执行最小CPU开销。|
    |总执行时间|语句执行总的时间开销。|
    |平均执行时间|语句平均每次执行时间开销。|
    |最大执行时间|语句执行最大的时间开销。|
    |最小执行时间|语句执行最小的时间开销。|
    |总逻辑读|语句执行总的逻辑读。|
    |平均逻辑读|语句平均每次执行逻辑读。|
    |最大逻辑读|语句执行最大逻辑读。|
    |最小逻辑读|语句执行最小逻辑读。|
    |总返回行|语句执行总的返回行数。|
    |平均返回行|语句平均每次执行返回行数。|
    |最大返回行|语句执行最大返回行数。|
    |最小返回行|语句执行最小返回行数。|
    |总物理读|语句执行总的物理读。|
    |平均物理读|语句平均每次执行物理读。|
    |最大物理读|语句执行最大物理读。|
    |最小物理读|语句执行最小物理读。|
    |总写入|语句执行总的写入量。|
    |平均写入|语句平均每次执行的写入量。|
    |最大写入|语句执行最大的写入量。|
    |最小写入|语句执行最小的写入量。|

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/64927/154745996632969_zh-CN.png)


