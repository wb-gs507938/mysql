# 解决无法连接实例问题 {#concept_cqq_x1d_sfb .concept}

无法连接RDS实例有多种情况，本文介绍各种情况下的解决办法。

在搭建业务场景调试的过程中，经常会出现无法连接RDS实例的情况，很多时候都是由于网络类型不统一、白名单未放通对应IP等导致的问题。

## 网络类型不同 {#section_i2s_5pc_sfb .section}

**ECS实例采用专有网络（VPC），RDS实例采用经典网络**

-   解决办法1（推荐）：将RDS实例从经典网络切换为VPC，具体操作请参见[切换网络类型](https://help.aliyun.com/document_detail/26194.html)。

    **说明：** 切换后，两者必须处于同一个VPC，才能内网互通。

-   解决办法二：重新购买经典网络的ECS实例（ECS实例不支持从VPC迁移到经典网络）。但是VPC比经典网络更安全，建议您使用VPC。
-   解决办法三：ECS实例使用RDS实例的公网连接地址连接RDS实例，即通过公网连接RDS实例。这种方式的性能、安全性、稳定性较差。

**ECS实例采用经典网络，RDS实例采用专有网络（VPC）**

-   解决办法一（推荐）：将ECS实例从经典网络迁移到VPC，具体操作请参见[单ECS迁移示例](https://help.aliyun.com/document_detail/57954.html)。

    **说明：** 切换后，两者必须处于同一个VPC，才能内网互通。

-   解决办法二：将RDS实例从VPC切换为经典网络。但是VPC比经典网络更安全，建议您使用VPC。
-   解决办法三：使用[ClassicLink](https://help.aliyun.com/document_detail/65412.html)功能，使经典网络的ECS实例可以和VPC中的云资源通过内网互通。。
-   解决办法四：ECS实例使用RDS实例的公网连接地址连接RDS实例，即通过公网连接RDS实例。这种方式的性能、安全性、稳定性较差。

## 专有网络（VPC）不同 {#section_dbb_stc_sfb .section}

专有网络VPC是基于阿里云构建的一个隔离的网络环境，专有网络之间逻辑上彻底隔离，所以当两个实例的网络类型都是专有网络时，还需要保证所属的专有网络也相同，才能互通。

-   解决办法一（推荐）：将RDS实例迁移到ECS实例所在的VPC。

    具体操作：参考[切换网络类型](https://help.aliyun.com/document_detail/26194.html)，先将RDS实例的网络类型从VPC切换到经典网络，再切换回VPC（切换时选择ECS实例所在的VPC）。

-   解决办法二：在两个VPC之间建立[高速通道](https://help.aliyun.com/document_detail/44843.html)。
-   解决办法三：通过公网互通。这种方式的性能、安全性、稳定性较差。

## 地域不同 {#section_v4b_r5c_sfb .section}

ECS实例和RDS实例位于不同的地域时，无法直接通过内网互通。

-   解决办法一：将原实例申请退款，重新购买。
-   解决办法二：ECS实例和RDS实例的网络类型都[设置为VPC](https://help.aliyun.com/document_detail/26194.html)，同时在两个VPC之间建立[高速通道](https://help.aliyun.com/document_detail/44843.html)。
-   解决办法三：通过外网互通。这种方式的性能、安全性、稳定性较差。

## 白名单未放通对应IP {#section_ank_fyc_sfb .section}

-   由于**数据安全性** \> **白名单设置**中只有默认地址127.0.0.1。该地址表示不允许任何设备访问RDS实例。因此需在白名单中添加对端的IP地址，具体操作请参见[设置白名单](https://help.aliyun.com/document_detail/26198.html)。
-   白名单设置成了0.0.0.0，正确格式为0.0.0.0/0。

    **说明：** 0.0.0.0/0表示允许任何设备访问RDS实例，请谨慎使用。

-   如果开启了[高安全白名单模式](https://help.aliyun.com/document_detail/88650.html)，需进行如下检查：
    -   如果使用的是专有网络的内网连接地址，请确保ECS内网IP地址添加到了专有网络的分组。
    -   如果使用的是经典网络的内网连接地址，请确保ECS内网IP地址添加到了经典网络的分组。
    -   如果通过公网连接，请确保设备公网IP地址添加到了经典网络的分组（专有网络的分组不适用于公网）。
-   您在白名单中添加的设备公网IP地址可能并非设备真正的出口IP地址。原因如下：

    -   公网IP地址不固定，可能会变动。

    -   IP地址查询工具或网站查询的公网IP地址不准确。

    解决办法请参见[定位本地IP](https://help.aliyun.com/document_detail/41754.html?spm=a2c4g.11186623.2.14.226e781bWbOItb)。


无法连接RDS实例的常见报错和解决办法

|数据库类型|错误信息|原因|解决办法|
|-----|----|--|----|
|MySQL| -   ERROR 2003 \(HY000\): Can’t connect to MySQL server on ‘XXX’\(10038或10060或110\)
-   无法连接到数据库：XXX

 |网络互通问题。|[点此查看](https://help.aliyun.com/knowledge_detail/91274.html)|
| -   ERROR 1045 \(HY000\): \#28000ip not in whitelist
-   ERROR 2801 \(HY000\): \#RDS00ip not in whitelist, client ip is XXX

 |白名单设置问题。|[点此查看](https://help.aliyun.com/knowledge_detail/91275.html)|
| -   ERROR 1045 \(28000\): Access denied for user ‘XXX’@’XXX’ \(using password: YES或NO\)

 |用户名或密码错误。|[点此查看](https://help.aliyun.com/knowledge_detail/91277.html)|
| -   ERROR 2005 \(HY000\): Unknown MySQL server host ‘xxxxxxx’ \(110或11004\)
-   SQLSTATE\[HY000\] \[2002\] php\_network\_getaddresses: getaddrinfo failed: Name or service not known
-   Name or service not known

 |DNS服务器无法解析地址。|[点此查看](https://help.aliyun.com/knowledge_detail/92120.html)|
|SQL Server| 无法连接到XXX。Cannot connect to XXX。

 在与 SQL Server 建立连接时出现与网络相关的或特定于实例的错误。未找到或无法访问服务器。请验证实例名称是否正确并且 SQL Server 已配置为允许远程连接。 \(provider: TCP Provider, error: 0 - 由于连接方在一段时间后没有正确答复或连接的主机没有反应，连接尝试失败。\) \(Microsoft SQL Server，错误: 10060或258\)

 |网络互通问题。|[点此查看](https://help.aliyun.com/knowledge_detail/91689.html)|
| 无法连接到XXX。Cannot connect to XXX。

 已成功与服务器建立连接，但是在登录过程中发生错误。\(provider:TCP提供程序,error:0-指定的网络名不再可用。\)\(Microsoft SQL Server，错误:64\)

 |白名单设置问题。|[点此查看](https://help.aliyun.com/document_detail/26198.html)|
|PostgreSQL/PPAS| Unable to connect to server:

 could not connect to server: Connection timed out \(0x0000274C/10060\)Is the server running on host “XXX.rds.aliyuncs.com” and acceptingTCP/IP connections on port XXX?

 |网络互通问题。|[点此查看](https://help.aliyun.com/knowledge_detail/91707.html)|
| -   server closed the connection unexpectedly This probably means the server terminated abnormally before or while processing the request.
-   Error connecting to the server: FATAL: no pg\_hba.conf entry

 |白名单设置问题。|[点此查看](https://help.aliyun.com/knowledge_detail/91697.html)|

